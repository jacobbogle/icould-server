<h2>Teens Management</h2>

<h3>Create New Teens Account</h3>
<p><strong>Family Accounts: {{ kids|length + teens|length }}/10</strong></p>
<form method="post" action="/">
    <input type="hidden" name="action" value="create_teen">
    <label>Teen Username: <input type="text" name="teen_username" required {% if kids|length + teens|length >= 10 %}disabled{% endif %}></label><br>
    <label>Password: <input type="password" name="password" required {% if kids|length + teens|length >= 10 %}disabled{% endif %}></label><br>
    <label>Confirm Password: <input type="password" name="confirm_password" required {% if kids|length + teens|length >= 10 %}disabled{% endif %}></label><br>
    <button type="submit" {% if kids|length + teens|length >= 10 %}disabled{% endif %}>
        {% if kids|length + teens|length >= 10 %}
            Account Limit Reached (10 max)
        {% else %}
            Create Teens Account
        {% endif %}
    </button>
</form>

<h3>Existing Teens Accounts</h3>
<ul>
    {% for teen in teens %}
    <li>
        {{ teen }}
        <button type="button" onclick="togglePasswordChange('{{ teen }}')">Change Password</button>
        <form method="post" action="/" style="display:inline;">
            <input type="hidden" name="action" value="delete_teen">
            <input type="hidden" name="teen_username" value="{{ teen }}">
            <button type="submit" onclick="return confirm('Are you sure you want to delete {{ teen }}?')">Delete</button>
        </form>
        <div id="password-change-{{ teen }}" class="password-change-dropdown" style="display: none; margin-top: 5px;">
            <form method="post" action="/" style="display: inline;">
                <input type="hidden" name="action" value="change_teen_password">
                <input type="hidden" name="teen_username" value="{{ teen }}">
                <label>New Password: <input type="password" name="new_password" required></label>
                <label>Confirm Password: <input type="password" name="confirm_password" required></label>
                <button type="submit">Update</button>
                <button type="button" onclick="togglePasswordChange('{{ teen }}')">Cancel</button>
            </form>
        </div>
    </li>
    {% endfor %}
</ul>

<script>
// Password validation function
function validatePasswordForm(form) {
    const newPassword = form.querySelector('input[name="new_password"]');
    const confirmPassword = form.querySelector('input[name="confirm_password"]');
    
    if (newPassword && confirmPassword && newPassword.value !== confirmPassword.value) {
        alert('Passwords do not match. Please try again.');
        return false;
    }
    return true;
}

// Add password validation to all password change forms
document.addEventListener('DOMContentLoaded', function() {
    const passwordForms = document.querySelectorAll('form input[name="new_password"]');
    passwordForms.forEach(function(input) {
        const form = input.closest('form');
        if (form) {
            form.addEventListener('submit', function(e) {
                if (!validatePasswordForm(form)) {
                    e.preventDefault();
                    return false;
                }
            });
        }
    });
    
    // Add password validation to create teen form
    const createTeenForm = document.querySelector('form[action="/"]');
    if (createTeenForm && createTeenForm.querySelector('input[name="teen_username"]')) {
        createTeenForm.addEventListener('submit', function(e) {
            const password = createTeenForm.querySelector('input[name="password"]');
            const confirmPassword = createTeenForm.querySelector('input[name="confirm_password"]');
            
            if (password && confirmPassword && password.value !== confirmPassword.value) {
                alert('Passwords do not match. Please try again.');
                e.preventDefault();
                return false;
            }
        });
    }
});
</script>